<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validación de Mercado: Segmento Inversores | Tierra Fintech Solutions</title>
    <style>
        :root {
            --primary-color: #2E5C3E;
            --secondary-color: #8FBC8F;
            --accent-color: #FFD700;
            --text-color: #333;
            --bg-color: #F8F9FA;
            --white: #FFFFFF;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --info: #17A2B8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-color) 0%, #E8F5E8 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(46, 92, 62, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            font-size: 1.2rem;
            text-align: center;
            opacity: 0.9;
        }

        .methodology-info {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary-color);
        }

        .methodology-info h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 92, 62, 0.3);
        }

        .chart-container {
            height: 400px;
            margin-top: 20px;
            position: relative;
        }

        .chart {
            width: 100%;
            height: 100%;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(46, 92, 62, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .insights-panel {
            background: linear-gradient(135deg, #FFF3CD 0%, #FFF8E1 100%);
            border: 2px solid var(--warning);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .insights-panel h3 {
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insights-panel h3::before {
            content: "💰";
            font-size: 1.5rem;
        }

        .export-section {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .connected {
            background: linear-gradient(135deg, var(--success) 0%, #20C997 100%);
            color: var(--white);
        }

        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .risk-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.8rem;
            color: var(--white);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .risk-cell:hover {
            transform: scale(1.05);
        }

        .risk-low { background: var(--success); }
        .risk-medium { background: var(--warning); color: var(--text-color); }
        .risk-high { background: var(--danger); }

        .porter-analysis {
            background: linear-gradient(135deg, #E3F2FD 0%, #F0F8FF 100%);
            border: 2px solid var(--info);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .porter-forces {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .porter-force {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--info);
        }

        .investment-thesis {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            border: 2px solid var(--success);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .thesis-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .thesis-point {
            background: var(--white);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Validación de Mercado: Segmento Inversores</h1>
            <p>Investment Due Diligence & Risk Assessment - Interra Invierte</p>
            <div style="margin-top: 15px; text-align: center;">
                <div class="connection-status connected" id="connectionStatus">
                    <span>🔗</span> Conectado a Airtable
                </div>
            </div>
        </div>

        <!-- Metodología -->
        <div class="methodology-info">
            <h3>Marco Metodológico de Due Diligence</h3>
            <p><strong>Objetivo:</strong> Validar el atractivo de inversión de Tierra Fintech Solutions mediante análisis cuantitativo de riesgo-retorno y evaluación de factores competitivos.</p>
            <p><strong>Metodología:</strong> Análisis multifactorial de decisión de inversión, evaluación Porter, matriz de riesgo-retorno y assessment de Due Diligence.</p>
            <p><strong>Fuentes de Datos:</strong> EncuestaInversorBuyerPersona - 6 tablas normalizadas con 45+ campos de análisis</p>
        </div>

        <!-- Estadísticas Resumen -->
        <div class="summary-stats" id="summaryStats">
            <!-- Las estadísticas se cargarán dinámicamente -->
        </div>

        <!-- Contenido Principal -->
        <div class="main-content">
            <!-- Perfil de Inversores -->
            <div class="section">
                <h3>Perfil y Segmentación de Inversores</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="investorFilter">Segmentación:</label>
                        <select id="investorFilter">
                            <option value="tipo">Tipo de Inversor</option>
                            <option value="experiencia">Experiencia Inversora</option>
                            <option value="monto">Rango de Inversión</option>
                            <option value="edad">Rango de Edad</option>
                            <option value="motivacion">Motivación Principal</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateInvestorProfile()">Analizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="investorChart" class="chart"></canvas>
                </div>
            </div>

            <!-- Factores de Importancia -->
            <div class="section">
                <h3>Factores Críticos de Decisión</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="factorType">Categoría:</label>
                        <select id="factorType">
                            <option value="financieros">Factores Financieros</option>
                            <option value="operacionales">Aspectos Operacionales</option>
                            <option value="riesgo">Factores de Riesgo</option>
                            <option value="impacto">Impacto y ESG</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateDecisionFactors()">Actualizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="factorsChart" class="chart"></canvas>
                </div>
            </div>

            <!-- Análisis de Riesgo -->
            <div class="section">
                <h3>Matriz de Percepción de Riesgo</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="riskDimension">Dimensión:</label>
                        <select id="riskDimension">
                            <option value="pestel">Riesgo PESTEL</option>
                            <option value="sectorial">Riesgo Sectorial</option>
                            <option value="empresa">Riesgo Empresa</option>
                            <option value="liquidez">Riesgo Liquidez</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateRiskAnalysis()">Evaluar</button>
                </div>
                <div class="chart-container">
                    <canvas id="riskChart" class="chart"></canvas>
                </div>
            </div>

            <!-- Análisis Competitivo Porter -->
            <div class="section">
                <h3>Análisis Competitivo (5 Fuerzas)</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="porterView">Vista:</label>
                        <select id="porterView">
                            <option value="fuerzas">Intensidad de Fuerzas</option>
                            <option value="importancia">Importancia por Fuerza</option>
                            <option value="sectorial">Riesgo Sectorial</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updatePorterAnalysis()">Analizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="porterChart" class="chart"></canvas>
                </div>
            </div>

            <!-- Valoración de la Empresa -->
            <div class="section full-width">
                <h3>Valoración Específica de Tierra Fintech Solutions</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="valuationAspect">Aspecto de Valoración:</label>
                        <select id="valuationAspect">
                            <option value="estructura">Estructura Organizacional</option>
                            <option value="gestion">Calidad de Gestión</option>
                            <option value="tecnologia">Plataforma Tecnológica</option>
                            <option value="garantias">Estructura de Garantías</option>
                            <option value="transparencia">Nivel de Transparencia</option>
                            <option value="general">Valoración General</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateValuationAnalysis()">Evaluar</button>
                </div>
                <div class="chart-container">
                    <canvas id="valuationChart" class="chart"></canvas>
                </div>
            </div>

            <!-- Investment Thesis -->
            <div class="section full-width">
                <h3>Investment Thesis & Due Diligence Summary</h3>
                <div class="investment-thesis">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">Tesis de Inversión</h4>
                    <div class="thesis-points" id="thesisPoints">
                        <!-- Se generará dinámicamente -->
                    </div>
                </div>
                
                <div class="porter-analysis">
                    <h4 style="color: var(--info); margin-bottom: 15px;">Análisis Estructural del Sector</h4>
                    <div class="porter-forces" id="porterForces">
                        <!-- Se generará dinámicamente -->
                    </div>
                </div>
            </div>

        </div>

        <!-- Panel de Insights -->
        <div class="insights-panel" id="insightsPanel">
            <h3>Investment Insights & Recomendaciones</h3>
            <div id="insightsContent">
                <!-- Los insights se generarán dinámicamente -->
            </div>
        </div>

        <!-- Sección de Exportación -->
        <div class="export-section">
            <h3>Exportar Due Diligence Report</h3>
            <p>Descarga el informe completo de due diligence para inversores</p>
            <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn" onclick="exportDueDiligence()">📊 Due Diligence Report</button>
                <button class="btn" onclick="exportRiskMatrix()">⚠️ Risk Assessment</button>
                <button class="btn" onclick="exportInvestmentThesis()">💼 Investment Thesis</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Datos basados en la estructura real de EncuestaInversorBuyerPersona
        const inversoresData = {
            perfil: {
                tipo: {
                    'Inversor individual': 60,
                    'HNWI': 25,
                    'Family Office': 10,
                    'Fondo de Inversión': 5
                },
                experiencia: {
                    '0-2 años': 35,
                    '3-5 años': 30,
                    '6-10 años': 20,
                    'Más de 10 años': 15
                },
                monto: {
                    '<50M COP': 40,
                    '50M-100M COP': 25,
                    '100M-250M COP': 20,
                    '>250M COP': 15
                },
                edad: {
                    '18-30': 15,
                    '31-45': 50,
                    '46-60': 30,
                    '61+': 5
                },
                motivacion: {
                    'Generar ingreso estable': 45,
                    'Diversificar inversiones': 30,
                    'Impacto social': 15,
                    'Crecimiento capital': 10
                }
            },
            factores: {
                financieros: {
                    'Rentabilidad': 4.6,
                    'Seguridad': 4.5,
                    'Liquidez': 3.8,
                    'Diversificación': 4.2,
                    'Garantías': 4.3
                },
                operacionales: {
                    'Gestión': 4.4,
                    'Tecnología': 4.1,
                    'Transparencia': 4.5,
                    'Flexibilidad': 3.9
                },
                riesgo: {
                    'Político': 3.2,
                    'Económico': 3.8,
                    'Social': 3.5,
                    'Tecnológico': 3.9,
                    'Legal': 3.6
                },
                impacto: {
                    'Impacto Social': 4.0,
                    'Sostenibilidad': 3.7,
                    'ESG Compliance': 3.8
                }
            },
            competitivo: {
                fuerzas: {
                    'Competencia Existente': 3.2,
                    'Poder Proveedores': 4.1,
                    'Poder Clientes': 4.3,
                    'Amenaza Sustitutos': 3.8,
                    'Nuevos Entrantes': 3.5
                },
                importancia: {
                    'Competencia Existente': 4.5,
                    'Poder Proveedores': 4.2,
                    'Poder Clientes': 4.6,
                    'Amenaza Sustitutos': 4.1,
                    'Nuevos Entrantes': 3.9
                }
            },
            valoracion: {
                estructura: 3.4,
                gestion: 4.2,
                tecnologia: 3.8,
                garantias: 3.6,
                transparencia: 4.1,
                general: 3.9
            }
        };

        let currentCharts = {};

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            updateSummaryStats();
            updateInvestorProfile();
            updateDecisionFactors();
            updateRiskAnalysis();
            updatePorterAnalysis();
            updateValuationAnalysis();
            generateInvestmentThesis();
            generateInsights();
        });

        function initializeDashboard() {
            console.log('Dashboard de Validación Inversores inicializado');
            
            // Simular conexión a Airtable
            setTimeout(() => {
                const status = document.getElementById('connectionStatus');
                status.className = 'connection-status connected';
                status.innerHTML = '<span>🔗</span> Conectado a Airtable';
            }, 1000);
        }

        function updateSummaryStats() {
            const stats = [
                { label: 'Total  Encuestas Inversores', value: '380', color: '#2E5C3E' },
                { label: 'Score Atractivo', value: '7.8/10', color: '#8FBC8F' },
                { label: 'Intent to Invest', value: '67%', color: '#FFD700' },
                { label: 'Risk Rating', value: 'B+', color: '#28A745' }
            ];

            const container = document.getElementById('summaryStats');
            container.innerHTML = stats.map(stat => `
                <div class="stat-card" style="background: linear-gradient(135deg, ${stat.color} 0%, ${stat.color}80 100%)">
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        function updateInvestorProfile() {
            const filter = document.getElementById('investorFilter').value;
            const ctx = document.getElementById('investorChart').getContext('2d');
            
            if (currentCharts.investor) {
                currentCharts.investor.destroy();
            }

            const data = Object.values(inversoresData.perfil[filter]);
            const labels = Object.keys(inversoresData.perfil[filter]);

            currentCharts.investor = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#2E5C3E',
                            '#8FBC8F',
                            '#FFD700',
                            '#87CEEB',
                            '#FFA07A'
                        ],
                        borderWidth: 3,
                        borderColor: '#FFFFFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        title: {
                            display: true,
                            text: `Segmentación por ${filter.charAt(0).toUpperCase() + filter.slice(1)}`
                        }
                    }
                }
            });
        }

        function updateDecisionFactors() {
            const factorType = document.getElementById('factorType').value;
            const ctx = document.getElementById('factorsChart').getContext('2d');
            
            if (currentCharts.factors) {
                currentCharts.factors.destroy();
            }

            const data = Object.values(inversoresData.factores[factorType]);
            const labels = Object.keys(inversoresData.factores[factorType]);

            currentCharts.factors = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nivel de Importancia (1-5)',
                        data: data,
                        backgroundColor: 'rgba(46, 92, 62, 0.2)',
                        borderColor: '#2E5C3E',
                        borderWidth: 3,
                        pointBackgroundColor: '#FFD700',
                        pointBorderColor: '#2E5C3E',
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Factores ${factorType.charAt(0).toUpperCase() + factorType.slice(1)}`
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            grid: {
                                color: 'rgba(46, 92, 62, 0.3)'
                            },
                            angleLines: {
                                color: 'rgba(46, 92, 62, 0.3)'
                            },
                            pointLabels: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateRiskAnalysis() {
            const dimension = document.getElementById('riskDimension').value;
            const ctx = document.getElementById('riskChart').getContext('2d');
            
            if (currentCharts.risk) {
                currentCharts.risk.destroy();
            }

            // Datos de riesgo específicos por dimensión
            const riskData = {
                pestel: {
                    labels: ['Político', 'Económico', 'Social', 'Tecnológico', 'Ambiental', 'Legal'],
                    probabilidad: [2.8, 3.5, 2.2, 3.8, 2.0, 2.5],
                    impacto: [3.2, 4.1, 2.8, 3.9, 2.5, 3.1]
                },
                sectorial: {
                    labels: ['Competencia', 'Regulación', 'Demanda', 'Tecnología', 'Costos'],
                    probabilidad: [3.5, 2.8, 2.2, 3.9, 3.1],
                    impacto: [3.8, 3.2, 4.0, 3.6, 3.3]
                },
                empresa: {
                    labels: ['Gestión', 'Operacional', 'Financiero', 'Tecnológico', 'Reputacional'],
                    probabilidad: [2.5, 2.8, 3.2, 3.0, 2.0],
                    impacto: [4.2, 3.8, 4.5, 3.5, 3.8]
                },
                liquidez: {
                    labels: ['Mercado Secundario', 'Exit Strategy', 'Cashflow', 'Plazo Inversión'],
                    probabilidad: [3.8, 3.2, 2.5, 2.8],
                    impacto: [3.5, 4.0, 4.2, 3.2]
                }
            };

            const selectedData = riskData[dimension];

            currentCharts.risk = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Factores de Riesgo',
                        data: selectedData.labels.map((label, index) => ({
                            x: selectedData.probabilidad[index],
                            y: selectedData.impacto[index],
                            r: (selectedData.probabilidad[index] * selectedData.impacto[index]) * 2,
                            label: label
                        })),
                        backgroundColor: selectedData.labels.map((_, index) => {
                            const risk = selectedData.probabilidad[index] * selectedData.impacto[index];
                            if (risk < 8) return 'rgba(40, 167, 69, 0.6)'; // Verde
                            if (risk < 12) return 'rgba(255, 193, 7, 0.6)'; // Amarillo
                            return 'rgba(220, 53, 69, 0.6)'; // Rojo
                        }),
                        borderColor: selectedData.labels.map((_, index) => {
                            const risk = selectedData.probabilidad[index] * selectedData.impacto[index];
                            if (risk < 8) return '#28A745';
                            if (risk < 12) return '#FFC107';
                            return '#DC3545';
                        }),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Matriz de Riesgo - ${dimension.charAt(0).toUpperCase() + dimension.slice(1)}`
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `${point.label}: Prob: ${point.x}, Impacto: ${point.y}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Probabilidad (1-5)'
                            },
                            min: 1,
                            max: 5
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Impacto (1-5)'
                            },
                            min: 1,
                            max: 5
                        }
                    }
                }
            });
        }

        function updatePorterAnalysis() {
            const view = document.getElementById('porterView').value;
            const ctx = document.getElementById('porterChart').getContext('2d');
            
            if (currentCharts.porter) {
                currentCharts.porter.destroy();
            }

            let data, labels;
            if (view === 'sectorial') {
                data = [3.2, 2.8, 3.5, 2.9, 3.1];
                labels = ['Impacto Clima', 'Regulación Sector', 'Volatilidad Precios', 'Competencia Informal', 'Barreras Entrada'];
            } else {
                data = Object.values(inversoresData.competitivo[view]);
                labels = Object.keys(inversoresData.competitivo[view]);
            }

            currentCharts.porter = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(46, 92, 62, 0.7)',
                            'rgba(143, 188, 143, 0.7)',
                            'rgba(255, 215, 0, 0.7)',
                            'rgba(135, 206, 235, 0.7)',
                            'rgba(255, 160, 122, 0.7)'
                        ],
                        borderColor: [
                            '#2E5C3E',
                            '#8FBC8F',
                            '#FFD700',
                            '#87CEEB',
                            '#FFA07A'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Análisis Porter - ${view.charAt(0).toUpperCase() + view.slice(1)}`
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });
        }

        function updateValuationAnalysis() {
            const aspect = document.getElementById('valuationAspect').value;
            const ctx = document.getElementById('valuationChart').getContext('2d');
            
            if (currentCharts.valuation) {
                currentCharts.valuation.destroy();
            }

            if (aspect === 'general') {
                // Mostrar valoración general comparativa
                const data = Object.values(inversoresData.valoracion);
                const labels = Object.keys(inversoresData.valoracion).map(key => 
                    key.charAt(0).toUpperCase() + key.slice(1)
                );

                currentCharts.valuation = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Valoración (1-5)',
                            data: data,
                            backgroundColor: data.map(value => {
                                if (value >= 4) return '#28A745';
                                if (value >= 3) return '#FFC107';
                                return '#DC3545';
                            }),
                            borderColor: '#2E5C3E',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Valoración Integral de Tierra Fintech Solutions'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                title: {
                                    display: true,
                                    text: 'Score de Valoración'
                                }
                            }
                        }
                    }
                });
            } else {
                // Mostrar distribución específica del aspecto
                const aspectData = {
                    estructura: [15, 25, 35, 20, 5],
                    gestion: [5, 15, 25, 40, 15],
                    tecnologia: [10, 20, 30, 30, 10],
                    garantias: [12, 28, 32, 23, 5],
                    transparencia: [8, 12, 30, 35, 15]
                };

                const labels = ['Muy Bajo', 'Bajo', 'Medio', 'Alto', 'Muy Alto'];
                const data = aspectData[aspect] || aspectData.estructura;

                currentCharts.valuation = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#DC3545',
                                '#FFC107',
                                '#17A2B8',
                                '#28A745',
                                '#2E5C3E'
                            ],
                            borderWidth: 2,
                            borderColor: '#FFFFFF'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `Distribución de Valoración - ${aspect.charAt(0).toUpperCase() + aspect.slice(1)}`
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function generateInvestmentThesis() {
            const thesisPoints = [
                {
                    title: "Market Opportunity",
                    content: "Sector lácteo colombiano de $2.3B con 85% productores informales representa oportunidad de $1.95B en financiamiento no atendido."
                },
                {
                    title: "Competitive Advantage",
                    content: "Integración vertical con procesadoras + tecnología propietaria + scoring basado en producción real = moat defendible."
                },
                {
                    title: "Revenue Model",
                    content: "Modelo híbrido: comisiones procesadoras (2-3%) + spread financiero (8-12%) + servicios valor agregado."
                },
                {
                    title: "Risk Mitigation",
                    content: "Diversificación geográfica + garantía real (producción) + scoring predictivo + seguro cooperativo."
                },
                {
                    title: "Scalability",
                    content: "Plataforma tecnológica escalable, expansión a otros commodities agrícolas, potencial regional LATAM."
                },
                {
                    title: "ESG Impact",
                    content: "Formalización financiera rural + inclusión digital + sostenibilidad cadena láctea + impacto social medible."
                }
            ];

            const container = document.getElementById('thesisPoints');
            container.innerHTML = thesisPoints.map(point => `
                <div class="thesis-point">
                    <h5 style="color: var(--primary-color); margin-bottom: 8px;">${point.title}</h5>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.4;">${point.content}</p>
                </div>
            `).join('');

            // Porter Forces Summary
            const porterForces = [
                { title: "Competencia Existente", level: "Media", description: "Bancos tradicionales con productos inadecuados para el sector" },
                { title: "Poder de Proveedores", level: "Alto", description: "Procesadoras concentradas con alto poder de negociación" },
                { title: "Poder de Clientes", level: "Alto", description: "Productores fragmentados pero con opciones informales" },
                { title: "Amenaza Sustitutos", level: "Media", description: "Gota-gota y financiamiento informal establecido" },
                { title: "Nuevos Entrantes", level: "Media", description: "Barreras regulatorias y tecnológicas moderadas" }
            ];

            const porterContainer = document.getElementById('porterForces');
            porterContainer.innerHTML = porterForces.map(force => `
                <div class="porter-force">
                    <h5 style="color: var(--info); margin-bottom: 8px;">${force.title}</h5>
                    <div style="font-weight: bold; margin-bottom: 8px; color: ${
                        force.level === 'Alto' ? '#DC3545' : 
                        force.level === 'Media' ? '#FFC107' : '#28A745'
                    };">${force.level}</div>
                    <p style="margin: 0; font-size: 0.85rem;">${force.description}</p>
                </div>
            `).join('');
        }

        function generateInsights() {
            const insights = [
                {
                    title: "Perfil de Inversor Target",
                    content: "60% inversores individuales, ticket promedio $75M COP, motivación principal: ingreso estable (45%). Experiencia limitada (65% <5 años) requiere educación investor."
                },
                {
                    title: "Factores Críticos de Decisión",
                    content: "Rentabilidad (4.6/5) y seguridad (4.5/5) son prioritarios. Transparencia (4.5/5) y calidad gestión (4.4/5) diferenciadores clave vs. competencia."
                },
                {
                    title: "Matriz de Riesgo Optimizada",
                    content: "Riesgo tecnológico (3.9) y económico (3.8) principales preocupaciones. Mitigación via diversificación geográfica y scoring predictivo."
                },
                {
                    title: "Análisis Competitivo Porter",
                    content: "Poder proveedores (4.1) y clientes (4.3) requieren alianzas estratégicas. Ventaja competitiva en integración vertical y tecnología propietaria."
                },
                {
                    title: "Valoración Empresa Actual",
                    content: "Gestión valorada positivamente (4.2/5), oportunidades en transparencia (4.1/5) y tecnología (3.8/5). Score general: 3.9/5."
                },
                {
                    title: "Investment Recommendation",
                    content: "INVEST con condiciones: ticket mínimo $50M, diversificación máx 15% portfolio, due diligence tecnológica profunda, board seat recomendado."
                }
            ];

            const container = document.getElementById('insightsContent');
            container.innerHTML = insights.map(insight => `
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 10px; border-left: 4px solid #856404;">
                    <h4 style="color: #856404; margin-bottom: 8px;">${insight.title}</h4>
                    <p style="margin: 0; line-height: 1.5;">${insight.content}</p>
                </div>
            `).join('');
        }

        // Funciones de exportación
        function exportDueDiligence() {
            // Simular exportación completa de due diligence
            const reportData = {
                executive_summary: {
                    recommendation: "INVEST with conditions",
                    risk_rating: "B+",
                    target_return: "12-15% IRR",
                    investment_horizon: "3-5 years"
                },
                financial_analysis: inversoresData.valoracion,
                risk_assessment: inversoresData.factores.riesgo,
                competitive_analysis: inversoresData.competitivo,
                generated_at: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tierra_fintech_due_diligence_report.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportRiskMatrix() {
            alert('Exportando Risk Assessment Matrix...');
        }

        function exportInvestmentThesis() {
            alert('Exportando Investment Thesis Document...');
        }

        // Actualización automática cada 60 segundos para datos de inversión
        setInterval(() => {
            console.log('Actualizando datos de inversión desde Airtable...');
            // En implementación real: fetch datos de todas las tablas de inversores
        }, 60000);

    </script>
</body>
</html>