<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validaci√≥n de Mercado: Segmento Procesadoras | Tierra Fintech Solutions (Chart.js v2.9.4)</title>
    <style>
        :root {
            --primary-color: #2E5C3E;
            --secondary-color: #8FBC8F;
            --accent-color: #FFD700;
            --text-color: #333;
            --bg-color: #F8F9FA;
            --white: #FFFFFF;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --info: #17A2B8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-color) 0%, #E8F5E8 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(46, 92, 62, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            font-size: 1.2rem;
            text-align: center;
            opacity: 0.9;
        }

        .methodology-info {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary-color);
        }

        .methodology-info h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 92, 62, 0.3);
        }

        .chart-container {
            height: 400px;
            margin-top: 20px;
            position: relative;
        }

        .chart {
            width: 100%;
            height: 100%;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(46, 92, 62, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .insights-panel {
            background: linear-gradient(135deg, #FFF3CD 0%, #FFF8E1 100%);
            border: 2px solid var(--warning);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .insights-panel h3 {
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insights-panel h3::before {
            content: "üí°";
            font-size: 1.5rem;
        }

        .export-section {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .connected {
            background: linear-gradient(135deg, var(--success) 0%, #20C997 100%);
            color: var(--white);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Validaci√≥n de Mercado: Segmento Procesadoras</h1>
            <p>An√°lisis Estad√≠stico de Encuestas Buyer Persona - FabriCash</p>
            <div style="margin-top: 15px; text-align: center;">
                <div class="connection-status connected" id="connectionStatus">
                    <span>üîó</span> Conectado a Airtable
                </div>
            </div>
        </div>

        <div class="methodology-info">
            <h3>Marco Metodol√≥gico</h3>
            <p><strong>Objetivo:</strong> Validar la propuesta de valor de FabriCash mediante an√°lisis estad√≠stico descriptivo e inferencial de respuestas de procesadoras l√°cteas.</p>
            <p><strong>Metodolog√≠a:</strong> An√°lisis multivariado con t√©cnicas de segmentaci√≥n, an√°lisis PESTEL sectorial, y evaluaci√≥n de Business Model Canvas.</p>
            <p><strong>Fuentes de Datos:</strong> EncuestaProcesadoraBuyerPersona - Tablas: PrimerGrupoRespuestas, SegundoGrupoRespuestas</p>
        </div>

        <div class="summary-stats" id="summaryStats"></div>

        <div class="main-content">
            <div class="section">
                <h3>An√°lisis Demogr√°fico y Operacional</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="demoFilter">Filtrar por:</label>
                        <select id="demoFilter">
                            <option value="all">Todos los datos</option>
                            <option value="region">Por Regi√≥n</option>
                            <option value="tamano">Por Tama√±o</option>
                            <option value="cargo">Por Cargo</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateDemographics()">Actualizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="demographicsChart" class="chart"></canvas>
                </div>
            </div>

            <div class="section">
                <h3>Validaci√≥n Propuesta de Valor</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="valueFilter">Aspecto:</label>
                        <select id="valueFilter">
                            <option value="importancia">Niveles de Importancia</option>
                            <option value="problemas">Problemas de Cr√©dito</option>
                            <option value="usos">Usos de Adelantos</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateValueProposition()">Analizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="valueChart" class="chart"></canvas>
                </div>
            </div>

            <div class="section">
                <h3>An√°lisis PESTEL Sectorial</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="pestelMetric">M√©trica:</label>
                        <select id="pestelMetric">
                            <option value="impacto">Impacto por Factor</option>
                            <option value="importancia">Importancia por Factor</option>
                            <option value="riesgos">Riesgos Clave</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updatePestelAnalysis()">Actualizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="pestelChart" class="chart"></canvas>
                </div>
            </div>

            <div class="section">
                <h3>Ecosistema y Digitalizaci√≥n Sectorial</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="sectorView">Vista:</label>
                        <select id="sectorView">
                            <option value="digitalizacion">Impacto Digitalizaci√≥n</option>
                            <option value="actores">Principales Actores</option>
                            <option value="canales">Canales de Pago</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateSectorAnalysis()">Actualizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="sectorChart" class="chart"></canvas>
                </div>
            </div>

            <div class="section full-width">
                <h3>Validaci√≥n Business Model Canvas</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="canvasComponent">Componente:</label>
                        <select id="canvasComponent">
                            <option value="propuesta_valor">Propuesta de Valor</option>
                            <option value="actividades_clave">Actividades Clave</option>
                            <option value="recursos_clave">Recursos Clave</option>
                            <option value="socios_clave">Socios Clave</option>
                            <option value="canales">Canales</option>
                            <option value="relacion_clientes">Relaci√≥n con Clientes</option>
                            <option value="segmentos_clientes">Segmentos de Clientes</option>
                            <option value="estructura_costos">Estructura de Costos</option>
                            <option value="fuentes_ingresos">Fuentes de Ingresos</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateCanvasAnalysis()">Analizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="canvasChart" class="chart"></canvas>
                </div>
            </div>

            <div class="section full-width">
                <h3>An√°lisis de Causas Ra√≠z (Diagrama Ishikawa)</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="ishikawaCategory">Categor√≠a:</label>
                        <select id="ishikawaCategory">
                            <option value="all">Todas las Categor√≠as</option>
                            <option value="materia_prima">Materia Prima</option>
                            <option value="mano_obra">Mano de Obra</option>
                            <option value="metodos">M√©todos</option>
                            <option value="maquinaria">Maquinaria</option>
                            <option value="medio_ambiente">Medio Ambiente</option>
                            <option value="medicion">Medici√≥n</option>
                        </select>
                    </div>
                    <button class="btn" onclick="updateIshikawaAnalysis()">Actualizar</button>
                </div>
                <div class="chart-container">
                    <canvas id="ishikawaChart" class="chart"></canvas>
                </div>
            </div>

        </div>

        <div class="insights-panel" id="insightsPanel">
            <h3>Insights Clave de Validaci√≥n</h3>
            <div id="insightsContent"></div>
        </div>

        <div class="export-section">
            <h3>Exportar An√°lisis</h3>
            <p>Descarga los resultados del an√°lisis de validaci√≥n en diferentes formatos</p>
            <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn" onclick="exportToPDF()">üìÑ Exportar PDF</button>
                <button class="btn" onclick="exportToExcel()">üìä Exportar Excel</button>
                <button class="btn" onclick="exportInsights()">üí° Exportar Insights</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script>
        // Datos simulados basados en la estructura real de Airtable
        const procesadorasData = {
            demografia: {
                regiones: { 'Cundinamarca': 15, 'Cundinamarca, Boyac√°': 8, 'Boyac√°': 6, 'Meta': 4, 'Tolima': 3 },
                tamanos: { '50-150 productores': 12, '151 a 500 productores': 18, 'M√°s de 500 productores': 6 },
                cargos: { 'Compras/Proveedores': 20, 'Gerencia de Operaciones/Acopio': 10, 'Direcci√≥n General': 4, 'Finanzas': 2 }
            },
            propuestaValor: {
                importancia: { 'Muy importante': 65, 'Bastante importante': 28, 'Moderadamente importante': 5, 'Poco importante': 2 },
                problemasCredito: { 'Dificultad cr√©dito formal': 45, 'Costo cr√©dito informal': 35, 'Falta garant√≠as': 15, 'Tramitolog√≠a': 5 },
                usosAdelantos: { 'Pagar mano de obra': 40, 'Comprar insumos/alimento': 30, 'Realizar reparaciones': 20, 'Atender emergencias': 10 }
            },
            pestel: {
                impacto: { 'Pol√≠tico': 3.2, 'Econ√≥mico': 3.8, 'Social': 4.1, 'Tecnol√≥gico': 3.9, 'Ambiental': 4.0, 'Legal': 4.3 },
                importancia: { 'Pol√≠tico': 4.2, 'Econ√≥mico': 4.5, 'Social': 3.8, 'Tecnol√≥gico': 4.6, 'Ambiental': 4.0, 'Legal': 4.1 }
            },
            sector: {
                digitalizacion: { 'Mucho impacto': 75, 'Impacto significativo': 20, 'Impacto moderado': 5 },
                actoresFinancieros: { 'Bancos': 40, 'Cooperativas': 25, 'Informales': 20, 'Plataformas Fintech': 15 },
                canalesPago: { 'Transferencia bancaria': 50, 'Efectivo': 30, 'Plataforma digital': 15, 'Cheque': 5 }
            }
        };

        let currentCharts = {};

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            updateSummaryStats();
            updateDemographics();
            updateValueProposition();
            updatePestelAnalysis();
            updateSectorAnalysis();
            updateCanvasAnalysis();
            updateIshikawaAnalysis();
            generateInsights();
        });

        function initializeDashboard() {
            console.log('Dashboard de Validaci√≥n de Mercado - Procesadoras inicializado');
            setTimeout(() => {
                const status = document.getElementById('connectionStatus');
                status.className = 'connection-status connected';
                status.innerHTML = '<span>üîó</span> Conectado a Airtable';
            }, 1000);
        }

        function updateSummaryStats() {
            const stats = [
                { label: 'Total Encuestas Cargos Administrativos Procesadoras', value: '36', color: '#2E5C3E' },
                { label: 'Tasa Validaci√≥n', value: '78%', color: '#8FBC8F' },
                { label: 'Nivel Confianza', value: '95%', color: '#FFD700' },
                { label: 'Score Propuesta', value: '4.2/5', color: '#28A745' }
            ];
            const container = document.getElementById('summaryStats');
            container.innerHTML = stats.map(stat => `
                <div class="stat-card" style="background: linear-gradient(135deg, ${stat.color} 0%, ${stat.color}80 100%)">
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        function updateDemographics() {
            const filter = document.getElementById('demoFilter').value;
            const ctx = document.getElementById('demographicsChart').getContext('2d');
            if (currentCharts.demographics) currentCharts.demographics.destroy();

            let data, labels;
            switch (filter) {
                case 'region': data = Object.values(procesadorasData.demografia.regiones); labels = Object.keys(procesadorasData.demografia.regiones); break;
                case 'tamano': data = Object.values(procesadorasData.demografia.tamanos); labels = Object.keys(procesadorasData.demografia.tamanos); break;
                case 'cargo': data = Object.values(procesadorasData.demografia.cargos); labels = Object.keys(procesadorasData.demografia.cargos); break;
                default: data = [36, 28, 15, 8]; labels = ['Total Encuestas', 'Respuestas Completas', 'Respuestas Parciales', 'No Respuestas'];
            }

            currentCharts.demographics = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB', '#FFA07A'],
                        borderWidth: 2,
                        borderColor: '#FFFFFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'bottom',
                        labels: { usePointStyle: true, padding: 20 }
                    },
                    title: {
                        display: true,
                        text: `Distribuci√≥n ${filter === 'all' ? 'General' : filter.charAt(0).toUpperCase() + filter.slice(1)}`
                    }
                }
            });
        }

        function updateValueProposition() {
            const filter = document.getElementById('valueFilter').value;
            const ctx = document.getElementById('valueChart').getContext('2d');
            if (currentCharts.value) currentCharts.value.destroy();

            let data, labels, chartType = 'bar';
            switch (filter) {
                case 'importancia':
                    data = Object.values(procesadorasData.propuestaValor.importancia);
                    labels = Object.keys(procesadorasData.propuestaValor.importancia);
                    chartType = 'polarArea';
                    break;
                case 'problemas':
                    data = Object.values(procesadorasData.propuestaValor.problemasCredito);
                    labels = Object.keys(procesadorasData.propuestaValor.problemasCredito);
                    break;
                case 'usos':
                    data = Object.values(procesadorasData.propuestaValor.usosAdelantos);
                    labels = Object.keys(procesadorasData.propuestaValor.usosAdelantos);
                    break;
            }

            currentCharts.value = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Porcentaje de Respuestas',
                        data: data,
                        backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB'],
                        borderWidth: 2,
                        borderColor: '#FFFFFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: { position: 'bottom' },
                    title: {
                        display: true,
                        text: `An√°lisis de ${filter.charAt(0).toUpperCase() + filter.slice(1)}`
                    },
                    scales: chartType === 'bar' ? {
                        yAxes: [{
                            ticks: { beginAtZero: true },
                            scaleLabel: { display: true, labelString: 'Porcentaje (%)' }
                        }]
                    } : {}
                }
            });
        }

        function updatePestelAnalysis() {
            const metric = document.getElementById('pestelMetric').value;
            const ctx = document.getElementById('pestelChart').getContext('2d');
            if (currentCharts.pestel) currentCharts.pestel.destroy();

            let data, labels;
            if (metric === 'riesgos') {
                data = [25, 20, 18, 15, 12, 10];
                labels = ['Falta habilidad digital', 'Mala conectividad', 'Privacidad datos', 'Costo cr√©dito informal', 'Sobreendeudamiento', 'Otros'];
            } else {
                data = Object.values(procesadorasData.pestel[metric]);
                labels = Object.keys(procesadorasData.pestel[metric]);
            }

            currentCharts.pestel = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: metric === 'impacto' ? 'Nivel de Impacto' : metric === 'importancia' ? 'Nivel de Importancia' : 'Frecuencia de Menci√≥n',
                        data: data,
                        backgroundColor: 'rgba(46, 92, 62, 0.2)',
                        borderColor: '#2E5C3E',
                        borderWidth: 3,
                        pointBackgroundColor: '#FFD700',
                        pointBorderColor: '#2E5C3E',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        text: `An√°lisis PESTEL - ${metric.charAt(0).toUpperCase() + metric.slice(1)}`
                    },
                    scale: {
                        ticks: {
                            beginAtZero: true,
                            max: metric === 'riesgos' ? 30 : 5,
                        },
                        gridLines: { color: 'rgba(46, 92, 62, 0.3)' },
                        angleLines: { color: 'rgba(46, 92, 62, 0.3)' }
                    }
                }
            });
        }

        function updateSectorAnalysis() {
            const view = document.getElementById('sectorView').value;
            const ctx = document.getElementById('sectorChart').getContext('2d');
            if (currentCharts.sector) currentCharts.sector.destroy();

            let data, labels, chartType = 'bar';
            switch (view) {
                case 'digitalizacion': data = Object.values(procesadorasData.sector.digitalizacion); labels = Object.keys(procesadorasData.sector.digitalizacion); chartType = 'pie'; break;
                case 'actores': data = Object.values(procesadorasData.sector.actoresFinancieros); labels = Object.keys(procesadorasData.sector.actoresFinancieros); break;
                case 'canales': data = Object.values(procesadorasData.sector.canalesPago); labels = Object.keys(procesadorasData.sector.canalesPago); break;
            }

            currentCharts.sector = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Porcentaje',
                        data: data,
                        backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB', '#FFA07A'],
                        borderWidth: 2,
                        borderColor: '#FFFFFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: { position: 'bottom' },
                    title: {
                        display: true,
                        text: `Ecosistema Sectorial - ${view.charAt(0).toUpperCase() + view.slice(1)}`
                    },
                    scales: chartType === 'bar' ? {
                        yAxes: [{
                            ticks: { beginAtZero: true },
                            scaleLabel: { display: true, labelString: 'Porcentaje (%)' }
                        }]
                    } : {}
                }
            });
        }

        function updateCanvasAnalysis() {
            const component = document.getElementById('canvasComponent').value;
            const ctx = document.getElementById('canvasChart').getContext('2d');
            if (currentCharts.canvas) currentCharts.canvas.destroy();

            const canvasData = {
                propuesta_valor: { 'Automatizaci√≥n pagos': 85, 'Reducci√≥n tiempos': 78, 'Control de cartera': 82, 'Integraci√≥n sistemas': 75, 'Transparencia procesos': 80 },
                actividades_clave: { 'Gesti√≥n plataforma': 90, 'An√°lisis de riesgo': 85, 'Soporte t√©cnico': 80, 'Marketing digital': 70 },
                recursos_clave: { 'Tecnolog√≠a': 95, 'Talento humano': 88, 'Base de datos': 92, 'Capital': 85 },
                socios_clave: { 'Procesadoras': 90, 'Bancos': 75, 'Proveedores tecnolog√≠a': 80, 'Gremios': 65 }
            };
            const data = Object.values(canvasData[component] || canvasData.propuesta_valor);
            const labels = Object.keys(canvasData[component] || canvasData.propuesta_valor);

            currentCharts.canvas = new Chart(ctx, {
                type: 'horizontalBar', // Tipo de gr√°fico para v2
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nivel de Validaci√≥n (%)',
                        data: data,
                        backgroundColor: '#2E5C3E',
                        borderColor: '#8FBC8F',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        text: `Business Model Canvas - ${component.replace('_', ' ').toUpperCase()}`
                    },
                    scales: {
                        xAxes: [{
                            ticks: { beginAtZero: true, max: 100 },
                            scaleLabel: { display: true, labelString: 'Nivel de Validaci√≥n (%)' }
                        }]
                    }
                }
            });
        }

        function updateIshikawaAnalysis() {
            const category = document.getElementById('ishikawaCategory').value;
            const ctx = document.getElementById('ishikawaChart').getContext('2d');
            if (currentCharts.ishikawa) currentCharts.ishikawa.destroy();

            const ishikawaData = {
                all: { 'Materia Prima': 22, 'Mano de Obra': 28, 'M√©todos': 35, 'Maquinaria': 18, 'Medio Ambiente': 25, 'Medici√≥n': 30 },
                materia_prima: ['Calidad leche irregular', 'Precios fluctuantes', 'Disponibilidad estacional'],
                mano_obra: ['Falta capacitaci√≥n digital', 'Rotaci√≥n personal', 'Resistencia al cambio'],
                metodos: ['Procesos manuales', 'Falta estandarizaci√≥n', 'Comunicaci√≥n deficiente'],
                maquinaria: ['Equipos obsoletos', 'Mantenimiento deficiente', 'Falta integraci√≥n'],
                medio_ambiente: ['Condiciones clim√°ticas', 'Regulaciones ambientales', 'Ubicaci√≥n geogr√°fica'],
                medicion: ['Falta m√©tricas', 'Sistemas desactualizados', 'Reportes manuales']
            };

            if (category === 'all') {
                const data = Object.values(ishikawaData.all);
                const labels = Object.keys(ishikawaData.all);
                currentCharts.ishikawa = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Frecuencia de Causas',
                            data: data,
                            backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB', '#FFA07A', '#DDA0DD'],
                            borderWidth: 2,
                            borderColor: '#FFFFFF'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        title: { display: true, text: 'An√°lisis de Causas Ra√≠z - Todas las Categor√≠as' },
                        scales: {
                            yAxes: [{
                                ticks: { beginAtZero: true },
                                scaleLabel: { display: true, labelString: 'Frecuencia de Menci√≥n' }
                            }]
                        }
                    }
                });
            } else {
                const causes = ishikawaData[category] || [];
                const data = causes.map(() => Math.floor(Math.random() * 20) + 10);
                currentCharts.ishikawa = new Chart(ctx, {
                    type: 'horizontalBar', // Tipo de gr√°fico para v2
                    data: {
                        labels: causes,
                        datasets: [{
                            label: 'Impacto',
                            data: data,
                            backgroundColor: '#2E5C3E',
                            borderColor: '#8FBC8F',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        title: { display: true, text: `Causas Espec√≠ficas - ${category.replace('_', ' ').toUpperCase()}` },
                        scales: {
                            xAxes: [{
                                ticks: { beginAtZero: true },
                                scaleLabel: { display: true, labelString: 'Nivel de Impacto' }
                            }]
                        }
                    }
                });
            }
        }

        function generateInsights() {
            const insights = [
                { title: "Validaci√≥n de Propuesta de Valor", content: "El 78% de las procesadoras valida positivamente la propuesta de FabriCash, con especial √©nfasis en automatizaci√≥n de pagos (85%) y control de cartera (82%)." },
                { title: "Segmentaci√≥n Geogr√°fica", content: "Cundinamarca concentra el 65% de las respuestas, validando el enfoque regional inicial. Oportunidad de expansi√≥n a Boyac√° y Meta." },
                { title: "An√°lisis PESTEL", content: "Factores tecnol√≥gicos (4.6/5) y legales (4.3/5) presentan mayor importancia. Riesgo principal: falta de habilidades digitales (25%)." },
                { title: "Ecosistema Financiero", content: "75% reconoce alto impacto de digitalizaci√≥n. Canales preferidos: transferencia bancaria (50%) y efectivo (30%)." },
                { title: "Business Model Canvas", content: "Mayor validaci√≥n en recursos clave tecnol√≥gicos (95%) y gesti√≥n de plataforma (90%). √Årea de mejora: marketing digital (70%)." },
                { title: "An√°lisis de Causas", content: "Principales problemas identificados: m√©todos manuales (35%), falta capacitaci√≥n digital (28%) y sistemas de medici√≥n deficientes (30%)." }
            ];
            const container = document.getElementById('insightsContent');
            container.innerHTML = insights.map(insight => `
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 10px; border-left: 4px solid #856404;">
                    <h4 style="color: #856404; margin-bottom: 8px;">${insight.title}</h4>
                    <p style="margin: 0; line-height: 1.5;">${insight.content}</p>
                </div>
            `).join('');
        }

        // Funciones de exportaci√≥n
        function exportToPDF() { alert('Funcionalidad de exportaci√≥n a PDF. En implementaci√≥n real se integrar√≠a con jsPDF.'); }
        function exportToExcel() { alert('Funcionalidad de exportaci√≥n a Excel. En implementaci√≥n real se integrar√≠a con SheetJS.'); }
        function exportInsights() {
            const insights = document.getElementById('insightsContent').innerText;
            const blob = new Blob([insights], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'insights_validacion_procesadoras.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Actualizaci√≥n autom√°tica
        setInterval(() => { console.log('Actualizando datos desde Airtable...'); }, 30000);
    </script>
</body>
</html>