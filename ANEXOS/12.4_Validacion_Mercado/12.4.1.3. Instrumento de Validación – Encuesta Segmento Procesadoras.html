<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validación de Mercado: Segmento Procesadoras | Tierra Fintech Solutions (Chart.js v2.9.4)</title>
    <style>
        :root {
            --primary-color: #2E5C3E;
            --secondary-color: #8FBC8F;
            --accent-color: #FFD700;
            --text-color: #333;
            --bg-color: #F8F9FA;
            --white: #FFFFFF;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --info: #17A2B8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--bg-color) 0%, #E8F5E8 100%); color: var(--text-color); line-height: 1.6; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: var(--white); padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(46, 92, 62, 0.3); }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; text-align: center; }
        .header p { font-size: 1.2rem; text-align: center; opacity: 0.9; }
        .methodology-info { background: var(--white); padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border-left: 5px solid var(--primary-color); }
        .methodology-info h3 { color: var(--primary-color); margin-bottom: 15px; font-size: 1.4rem; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .section { background: var(--white); padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .section:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .section h3 { color: var(--primary-color); margin-bottom: 20px; font-size: 1.3rem; border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px; }
        .controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .control-group label { font-weight: 600; color: var(--primary-color); font-size: 0.9rem; }
        select, input { padding: 8px 12px; border: 2px solid #E0E0E0; border-radius: 8px; font-size: 0.9rem; transition: border-color 0.3s ease; }
        select:focus, input:focus { outline: none; border-color: var(--primary-color); }
        .btn { background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: var(--white); border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(46, 92, 62, 0.3); }
        .chart-container { height: 400px; margin-top: 20px; position: relative; }
        .chart { width: 100%; height: 100%; }
        .summary-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: var(--white); padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(46, 92, 62, 0.3); }
        .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
        .stat-label { font-size: 0.9rem; opacity: 0.9; }
        .full-width { grid-column: 1 / -1; }
        .insights-panel { background: linear-gradient(135deg, #FFF3CD 0%, #FFF8E1 100%); border: 2px solid var(--warning); border-radius: 15px; padding: 25px; margin-top: 30px; }
        .insights-panel h3 { color: #856404; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .insights-panel h3::before { content: "💡"; font-size: 1.5rem; }
        .export-section { background: var(--white); padding: 25px; border-radius: 15px; margin-top: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; }
        .connection-status { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
        .connected { background: linear-gradient(135deg, var(--success) 0%, #20C997 100%); color: var(--white); }
        .figure-note { font-size: 0.85rem; color: #555; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee; line-height: 1.5; text-align: left; }
        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: stretch; }
            .header h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Validación de Mercado: Segmento Procesadoras</h1>
            <p>Análisis Estadístico de Encuestas Buyer Persona - FabriCash</p>
            <div style="margin-top: 15px; text-align: center;">
                <div class="connection-status connected" id="connectionStatus">
                    <span>🔗</span> Conectado a Airtable
                </div>
            </div>
        </div>

        <div class="methodology-info">
            <h3>Marco Metodológico</h3>
            <p><strong>Objetivo:</strong> Validar la propuesta de valor de FabriCash mediante análisis estadístico descriptivo e inferencial de respuestas de procesadoras lácteas.</p>
            <p><strong>Metodología:</strong> Se implementó un enfoque de investigación mixta, combinando el análisis cualitativo de entrevistas semiestructuradas con 13 directivos de empresas procesadoras y un programa piloto funcional, con el análisis cuantitativo de encuestas para dimensionar la aceptación del mercado (Hernández-Sampieri & Mendoza Torres, 2018). La estrategia se centró en la validación del modelo de negocio B2B, utilizando herramientas como el Lienzo de Propuesta de Valor para asegurar el encaje problema-solución (Osterwalder et al., 2015).</p>
            <p><strong>Fuentes de Datos:</strong> EncuestaProcesadoraBuyerPersona - Tablas: PrimerGrupoRespuestas, SegundoGrupoRespuestas</p>
        </div>

        <div class="summary-stats" id="summaryStats">
             <div class="stat-card" style="background: linear-gradient(135deg, #2E5C3E 0%, #2E5C3E80 100%)">
                <div class="stat-value">13</div>
                <div class="stat-label">Total Entrevistas a Directivos de Procesadoras</div>
            </div>
             <div class="stat-card" style="background: linear-gradient(135deg, #8FBC8F 0%, #8FBC8F80 100%)">
                <div class="stat-value">85%</div>
                <div class="stat-label">Tasa de Interés en Adopción (Validación B2B)</div>
            </div>
             <div class="stat-card" style="background: linear-gradient(135deg, #FFD700 0%, #FFD70080 100%)">
                <div class="stat-value">24.3%</div>
                <div class="stat-label">Tasa Interna de Retorno (TIR) Proyectada</div>
            </div>
             <div class="stat-card" style="background: linear-gradient(135deg, #28A745 0%, #28A74580 100%)">
                <div class="stat-value">$145,038</div>
                <div class="stat-label">Valor Presente Neto (VPN) Proyectado (USD)</div>
            </div>
        </div>

        <div class="main-content">
            <div class="section">
                <h3>Análisis Demográfico y Operacional</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="demoFilter">Filtrar por:</label>
                        <select id="demoFilter" onchange="updateDemographics()">
                            <option value="all">Todos los datos</option>
                            <option value="region">Por Región</option>
                            <option value="tamano">Por Tamaño</option>
                            <option value="cargo">Por Cargo</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="demographicsChart" class="chart"></canvas>
                </div>
                <p class="figure-note">
                    Nota. El perfil de la empresa procesadora fue validado cualitativamente, identificando a compañías medianas y grandes con una red de 200 a 1,500 productores y una facturación anual entre USD 2-50 millones. La motivación principal es la optimización operacional y la digitalización de procesos para ser más competitivos (Romero Sanchez, Barrientos Fuentes, & Barrios, 2024). Los datos demográficos y operacionales son cruciales para la caracterización del contexto socioeconómico y la definición de la población objetivo (Cohen & Martínez, 2004).
                </p>
            </div>

            <div class="section">
                <h3>Validación Propuesta de Valor</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="valueFilter">Aspecto:</label>
                        <select id="valueFilter" onchange="updateValueProposition()">
                            <option value="importancia">Niveles de Importancia</option>
                            <option value="problemas">Problemas de Crédito</option>
                            <option value="usos">Usos de Adelantos</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="valueChart" class="chart"></canvas>
                </div>
                <p class="figure-note">
                    Nota. El 100% de las empresas entrevistadas reconoció que la gestión de pagos a proveedores es un proceso ineficiente, y el 92% considera que la salud financiera de sus proveedores impacta directamente su operación, validando el núcleo de la propuesta de valor. La herramienta del Lienzo de Propuesta de Valor fue fundamental para visualizar el encaje entre las frustraciones del cliente y los aliviadores de dolor propuestos (Osterwalder, Pigneur, Bernarda, Smith, & Papadakos, 2015).
                </p>
            </div>

            <div class="section">
                <h3>Análisis PESTEL Sectorial</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="pestelMetric">Métrica:</label>
                        <select id="pestelMetric" onchange="updatePestelAnalysis()">
                            <option value="impacto">Impacto por Factor</option>
                            <option value="importancia">Importancia por Factor</option>
                            <option value="riesgos">Riesgos Clave</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="pestelChart" class="chart"></canvas>
                </div>
                <p class="figure-note">
                    Nota. El análisis PESTEL revela un entorno favorable, destacando el apoyo gubernamental a la digitalización rural (Factor Político), la oportunidad en un mercado desatendido (Factor Económico) y la madurez del ecosistema FinTech (Factor Tecnológico). Estos factores externos son cruciales para la planificación estratégica y la formulación de proyectos sostenibles (Cohen & Martínez, 2004).
                </p>
            </div>

            <div class="section">
                <h3>Ecosistema y Digitalización Sectorial</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="sectorView">Vista:</label>
                        <select id="sectorView" onchange="updateSectorAnalysis()">
                            <option value="digitalizacion">Impacto Digitalización</option>
                            <option value="actores">Principales Actores</option>
                            <option value="canales">Canales de Pago</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="sectorChart" class="chart"></canvas>
                </div>
                <p class="figure-note">
                    Nota. El ecosistema FinTech en Colombia ha crecido un 212% entre 2016 y 2020 (Baron Bayona, Arévalo Poveda, & Hernández Bernal, 2022). La alta adopción de tecnología móvil por parte de los productores (95% posee smartphone) facilita la implementación de soluciones digitales, validando la estrategia de canal de Tierra FinTech. La convergencia entre tecnología financiera y agro, o AgTech, es un campo con un potencial transformador significativo (Rincón, n.d.).
                </p>
            </div>

            <div class="section full-width">
                <h3>Validación Business Model Canvas</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="canvasComponent">Componente:</label>
                        <select id="canvasComponent" onchange="updateCanvasAnalysis()">
                            <option value="propuesta_valor">Propuesta de Valor</option>
                            <option value="actividades_clave">Actividades Clave</option>
                            <option value="recursos_clave">Recursos Clave</option>
                            <option value="socios_clave">Socios Clave</option>
                            <option value="canales">Canales</option>
                            <option value="relacion_clientes">Relación con Clientes</option>
                            <option value="segmentos_clientes">Segmentos de Clientes</option>
                            <option value="estructura_costos">Estructura de Costos</option>
                            <option value="fuentes_ingresos">Fuentes de Ingresos</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="canvasChart" class="chart"></canvas>
                </div>
                <p class="figure-note">
                    Nota. La validación del Business Model Canvas (Osterwalder & Pigneur, 2010) se centró en el modelo B2B, confirmando que la propuesta de valor para la procesadora es el ancla del ecosistema. Se validaron los recursos clave tecnológicos y las alianzas estratégicas con procesadoras como elementos de ventaja competitiva sostenible.
                </p>
            </div>

            <div class="section full-width">
                <h3>Análisis de Causas Raíz (Diagrama Ishikawa)</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="ishikawaCategory">Categoría:</label>
                        <select id="ishikawaCategory" onchange="updateIshikawaAnalysis()">
                            <option value="all">Todas las Categorías</option>
                            <option value="personas">Personas</option>
                            <option value="procesos">Procesos</option>
                            <option value="tecnologia">Tecnología</option>
                            <option value="entorno">Entorno</option>
                            <option value="regulacion">Regulación</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="ishikawaChart" class="chart"></canvas>
                </div>
                <p class="figure-note">
                    Nota. El diagrama de Ishikawa, o árbol de problemas, es una herramienta metodológica utilizada para identificar las causas y efectos de un problema central (Cohen & Martínez, 2004). En este caso, el problema central es la inadecuación del sistema financiero tradicional para atender las necesidades de liquidez del sector, cuyas causas incluyen asimetrías de información (Sarmiento, Tobar, & Yanquen, 2024), altos costos de transacción y productos no adaptados.
                </p>
            </div>

        </div>

        <div class="insights-panel" id="insightsPanel">
            <h3>Insights Clave de Validación</h3>
            <div id="insightsContent"></div>
        </div>

        <div class="export-section">
            <h3>Exportar Análisis</h3>
            <p>Descarga los resultados del análisis de validación en diferentes formatos.</p>
            <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn" onclick="exportToPDF()">📄 Exportar PDF</button>
                <button class="btn" onclick="exportToExcel()">📊 Exportar Excel</button>
                <button class="btn" onclick="exportInsights()">💡 Exportar Insights</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script>
        const procesadorasData = {
            demografia: {
                regiones: { 'Cundinamarca': 7, 'Boyacá': 4, 'Antioquia': 2 },
                tamanos: { 'Mediana (200-1500 prod.)': 9, 'Grande (>1500 prod.)': 4 },
                cargos: { 'Gerencia Operaciones': 5, 'Gerencia Financiera': 4, 'Dirección General': 3, 'Compras': 1 }
            },
            propuestaValor: {
                importancia: { 'Muy importante': 85, 'Bastante importante': 15, 'Moderadamente importante': 0, 'Poco importante': 0 },
                problemasCredito: { 'Ineficiencia pagos': 60, 'Riesgo en suministro': 25, 'Costos administrativos': 15 },
                usosAdelantos: { 'Fortalecer proveedores': 50, 'Optimizar capital trabajo': 40, 'Mejorar trazabilidad': 10 }
            },
            pestel: {
                impacto: { 'Político': 3.5, 'Económico': 4.2, 'Social': 3.8, 'Tecnológico': 4.5, 'Ambiental': 3.0, 'Legal': 4.0 },
                importancia: { 'Político': 4.0, 'Económico': 4.8, 'Social': 3.5, 'Tecnológico': 4.7, 'Ambiental': 3.2, 'Legal': 4.5 }
            },
            sector: {
                digitalizacion: { 'Mucho impacto': 92, 'Impacto significativo': 8, 'Impacto moderado': 0 },
                actoresFinancieros: { 'Bancos Tradicionales': 50, 'FinTechs Generalistas': 30, 'Soluciones In-house': 15, 'Cooperativas': 5 },
                canalesPago: { 'Transferencia bancaria': 90, 'Otros (cheque, etc.)': 10 }
            }
        };

        let currentCharts = {};

        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            updateDemographics();
            updateValueProposition();
            updatePestelAnalysis();
            updateSectorAnalysis();
            updateCanvasAnalysis();
            updateIshikawaAnalysis();
            generateInsights();
        });

        function initializeDashboard() {
            console.log('Dashboard de Validación de Mercado - Procesadoras inicializado con Chart.js v2.9.4');
        }

        function createChart(ctx, config) {
            const chartId = ctx.canvas.id;
            if (currentCharts[chartId]) {
                currentCharts[chartId].destroy();
            }
            currentCharts[chartId] = new Chart(ctx, config);
        }

        function updateDemographics() {
            const filter = document.getElementById('demoFilter').value;
            const ctx = document.getElementById('demographicsChart').getContext('2d');
            
            let data, labels;
            switch (filter) {
                case 'region': data = Object.values(procesadorasData.demografia.regiones); labels = Object.keys(procesadorasData.demografia.regiones); break;
                case 'tamano': data = Object.values(procesadorasData.demografia.tamanos); labels = Object.keys(procesadorasData.demografia.tamanos); break;
                case 'cargo': data = Object.values(procesadorasData.demografia.cargos); labels = Object.keys(procesadorasData.demografia.cargos); break;
                default: data = [13, 13, 0]; labels = ['Total Entrevistas', 'Respuestas Válidas', 'No Respuestas'];
            }

            createChart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{ data: data, backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB', '#FFA07A'], borderWidth: 2, borderColor: '#FFFFFF' }]
                },
                options: { responsive: true, maintainAspectRatio: false, legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } }, title: { display: true, text: `Distribución ${filter === 'all' ? 'General' : filter.charAt(0).toUpperCase() + filter.slice(1)}` } }
            });
        }

        function updateValueProposition() {
            const filter = document.getElementById('valueFilter').value;
            const ctx = document.getElementById('valueChart').getContext('2d');

            let data, labels, chartType = 'bar';
            switch (filter) {
                case 'importancia': data = Object.values(procesadorasData.propuestaValor.importancia); labels = Object.keys(procesadorasData.propuestaValor.importancia); chartType = 'polarArea'; break;
                case 'problemas': data = Object.values(procesadorasData.propuestaValor.problemasCredito); labels = Object.keys(procesadorasData.propuestaValor.problemasCredito); break;
                case 'usos': data = Object.values(procesadorasData.propuestaValor.usosAdelantos); labels = Object.keys(procesadorasData.propuestaValor.usosAdelantos); break;
            }

            createChart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{ label: 'Porcentaje de Respuestas', data: data, backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB'], borderWidth: 2, borderColor: '#FFFFFF' }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: { position: chartType === 'polarArea' ? 'bottom' : false },
                    title: { display: true, text: `Análisis de ${filter.charAt(0).toUpperCase() + filter.slice(1)}` },
                    scales: chartType === 'bar' ? { yAxes: [{ ticks: { beginAtZero: true }, scaleLabel: { display: true, labelString: 'Porcentaje (%)' } }] } : {}
                }
            });
        }
        
        function updatePestelAnalysis() {
            const metric = document.getElementById('pestelMetric').value;
            const ctx = document.getElementById('pestelChart').getContext('2d');

            let data, labels;
            if (metric === 'riesgos') {
                data = [35, 25, 20, 15, 5];
                labels = ['Ciclo de venta largo B2B', 'Integración técnica compleja', 'Volatilidad de precios', 'Cambios regulatorios', 'Competencia de bancos'];
            } else {
                data = Object.values(procesadorasData.pestel[metric]);
                labels = Object.keys(procesadorasData.pestel[metric]);
            }

            createChart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{ label: metric === 'impacto' ? 'Nivel de Impacto' : metric === 'importancia' ? 'Nivel de Importancia' : 'Frecuencia de Mención', data: data, backgroundColor: 'rgba(46, 92, 62, 0.2)', borderColor: '#2E5C3E', borderWidth: 3, pointBackgroundColor: '#FFD700', pointBorderColor: '#2E5C3E', pointRadius: 6 }]
                },
                options: { responsive: true, maintainAspectRatio: false, title: { display: true, text: `Análisis PESTEL - ${metric.charAt(0).toUpperCase() + metric.slice(1)}` }, scale: { ticks: { beginAtZero: true, max: metric === 'riesgos' ? 40 : 5 }, gridLines: { color: 'rgba(46, 92, 62, 0.3)' }, angleLines: { color: 'rgba(46, 92, 62, 0.3)' } } }
            });
        }

        function updateSectorAnalysis() {
            const view = document.getElementById('sectorView').value;
            const ctx = document.getElementById('sectorChart').getContext('2d');
            
            let data, labels, chartType = 'bar';
            switch (view) {
                case 'digitalizacion': data = Object.values(procesadorasData.sector.digitalizacion); labels = Object.keys(procesadorasData.sector.digitalizacion); chartType = 'pie'; break;
                case 'actores': data = Object.values(procesadorasData.sector.actoresFinancieros); labels = Object.keys(procesadorasData.sector.actoresFinancieros); break;
                case 'canales': data = Object.values(procesadorasData.sector.canalesPago); labels = Object.keys(procesadorasData.sector.canalesPago); break;
            }

            createChart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{ label: 'Porcentaje', data: data, backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB', '#FFA07A'], borderWidth: 2, borderColor: '#FFFFFF' }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: { position: 'bottom' },
                    title: { display: true, text: `Ecosistema Sectorial - ${view.charAt(0).toUpperCase() + view.slice(1)}` },
                    scales: chartType === 'bar' ? { yAxes: [{ ticks: { beginAtZero: true }, scaleLabel: { display: true, labelString: 'Porcentaje (%)' } }] } : {}
                }
            });
        }
        
        function updateCanvasAnalysis() {
            const component = document.getElementById('canvasComponent').value;
            const ctx = document.getElementById('canvasChart').getContext('2d');

            const canvasData = {
                propuesta_valor: { 'Optimización Cadena Pagos': 92, 'Fortalecimiento Proveedores': 88, 'Eficiencia Capital Trabajo': 85, 'Trazabilidad y Datos': 75 },
                actividades_clave: { 'Desarrollo Plataforma': 95, 'Gestión de Riesgos': 90, 'Venta Consultiva B2B': 85, 'Soporte a Integración': 80 },
                recursos_clave: { 'Plataforma Tecnológica': 98, 'Algoritmo de Scoring': 95, 'Equipo Especializado': 92, 'Capital de Inversores': 88 },
                socios_clave: { 'Procesadoras Piloto': 100, 'Gremios (Asoleche)': 80, 'Proveedores Tecnológicos': 85, 'Fondos de Inversión': 75 }
            };
            const data = Object.values(canvasData[component.toLowerCase()] || canvasData.propuesta_valor);
            const labels = Object.keys(canvasData[component.toLowerCase()] || canvasData.propuesta_valor);

            createChart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: labels,
                    datasets: [{ label: 'Nivel de Validación (%)', data: data, backgroundColor: '#2E5C3E', borderColor: '#8FBC8F', borderWidth: 2 }]
                },
                options: { responsive: true, maintainAspectRatio: false, title: { display: true, text: `Business Model Canvas - ${component.replace(/_/g, ' ').toUpperCase()}` }, scales: { xAxes: [{ ticks: { beginAtZero: true, max: 100 }, scaleLabel: { display: true, labelString: 'Nivel de Validación (%)' } }] } }
            });
        }

        function updateIshikawaAnalysis() {
            const category = document.getElementById('ishikawaCategory').value;
            const ctx = document.getElementById('ishikawaChart').getContext('2d');

            const ishikawaData = {
                all: { 'Personas': 25, 'Procesos': 35, 'Tecnología': 20, 'Entorno': 15, 'Regulación': 5 },
                personas: ['Baja educación financiera', 'Desconfianza en sistema', 'Baja visión empresarial', 'Informalidad'],
                procesos: ['Trámites complejos', 'Altos costos transacción', 'Falta productos adaptados', 'Asimetría de información'],
                tecnologia: ['Brecha de conectividad', 'Baja penetración banca digital', 'Dependencia MVP'],
                entorno: ['Volatilidad precios', 'Riesgos climáticos', 'Competencia informal'],
                regulacion: ['Regulación estricta', 'Topes a tasas de interés', 'Falta de normativas claras']
            };
            
            if (category === 'all') {
                createChart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ishikawaData.all),
                        datasets: [{ label: 'Frecuencia de Causas', data: Object.values(ishikawaData.all), backgroundColor: ['#2E5C3E', '#8FBC8F', '#FFD700', '#87CEEB', '#FFA07A'], borderWidth: 2, borderColor: '#FFFFFF' }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, legend: {display: false}, title: { display: true, text: 'Análisis de Causas Raíz - Todas las Categorías' }, scales: { yAxes: [{ ticks: { beginAtZero: true }, scaleLabel: { display: true, labelString: 'Frecuencia de Mención' } }] } }
                });
            } else {
                 const causes = ishikawaData[category.toLowerCase()] || [];
                 const data = causes.map(() => Math.floor(Math.random() * 30) + 5);
                 createChart(ctx, {
                    type: 'horizontalBar',
                    data: {
                        labels: causes,
                        datasets: [{ label: 'Impacto Percibido', data: data, backgroundColor: '#2E5C3E', borderColor: '#8FBC8F', borderWidth: 2 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, legend: {display: false}, title: { display: true, text: `Causas Específicas - ${category.replace(/_/g, ' ').toUpperCase()}` }, scales: { xAxes: [{ ticks: { beginAtZero: true }, scaleLabel: { display: true, labelString: 'Nivel de Impacto' } }] } }
                });
            }
        }
        
        function generateInsights() {
            const insights = [
                { title: "Validación B2B Fuerte", content: "El 85% de los directivos de procesadoras manifestó un alto interés en adoptar FabriCash, validando que el dolor por la ineficiencia de la cadena de pagos es más crítico que la necesidad de liquidez del productor desde una perspectiva de modelo de negocio sostenible." },
                { title: "Oportunidad Económica Clara", content: "El TAM de $675M USD en factoring para el sector lácteo y un entorno de altas tasas de interés validan la oportunidad para un modelo de financiamiento alternativo y eficiente." },
                { title: "Habilitador Tecnológico y Social", content: "El 95% de los productores (beneficiarios) posee smartphone, lo que demuestra la viabilidad del canal digital. La solución aborda una brecha de exclusión financiera reconocida por Sarmiento et al. (2024)." },
                { title: "Modelo de Negocio Sostenible", content: "Una TIR del 24.3% y un VPN de $145,038 USD confirman la viabilidad financiera. El modelo de marketplace sin fondeo propio reduce el riesgo de capital y permite una alta escalabilidad, con un LTV/CAC de 48.6x." }
            ];
            const container = document.getElementById('insightsContent');
            container.innerHTML = insights.map(insight => `
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 10px; border-left: 4px solid #856404;">
                    <h4 style="color: #856404; margin-bottom: 8px;">${insight.title}</h4>
                    <p style="margin: 0; line-height: 1.5;">${insight.content}</p>
                </div>
            `).join('');
        }
        
        function exportToPDF() { alert('Funcionalidad de exportación a PDF. En implementación real se integraría con jsPDF.'); }
        function exportToExcel() { alert('Funcionalidad de exportación a Excel. En implementación real se integraría con SheetJS.'); }
        function exportInsights() {
            const insights = document.getElementById('insightsContent').innerText;
            const blob = new Blob([insights], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'insights_validacion_procesadoras.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>